一、功能总结
1、重写 sys_get_time 和 sys_task_info
在使用虚拟地址空间后，用户态和内核态分别使用不同的地址空间。用户态地址空间中的地址指针不能在内核态中直接使用，需要进行地址/指针翻译。

2、mmap 和 munmap 匿名映射
在实现mmap时，通过memory_set.translate和is_valid检查area是否已经被映射，最后通过insert_framed_area插入新的映射。
在实现munmap时，通过memory_set.translate和is_valid检查area是否已经被映射，最后通过新实现的remove_framed_area函数删除制定的映射。不考虑接触area中部分映射的情况。

二、简答作业
1、请列举 SV39 页表页表项的组成，描述其中的标志位有何作用？
答：SV39页表项总共有64位，由Reserved(10bits)、PPN(44bits)、RSW(2bits)、标志位(8bits)组成。
其中标志位的含义如下：
    仅当 V(Valid) 位为 1 时，页表项才是合法的；
    R/W/X 分别控制索引到这个页表项的对应虚拟页面是否允许读/写/取指；
    U 控制索引到这个页表项的对应虚拟页面是否在 CPU 处于 U 特权级的情况下是否被允许访问；
    G 我们不理会；
    A(Accessed) 记录自从页表项上的这一位被清零之后，页表项的对应虚拟页面是否被访问过；
    D(Dirty) 则记录自从页表项上的这一位被清零之后，页表项的对应虚拟页表是否被修改过。


2、缺页
缺页指的是进程访问页面时页面不在页表中或在页表中无效的现象，此时 MMU 将会返回一个中断， 告知 os 进程内存访问出了问题。os 选择填补页表并重新执行异常指令或者杀死进程。
 1）请问哪些异常可能是缺页导致的？
 答：Exception::StoreFault、Exception::StorePageFault、Exception::LoadFault、Exception::LoadPageFault四种异常可能是缺页导致的。
 2）发生缺页时，描述相关重要寄存器的值，上次实验描述过的可以简略。
 答：RISC-V 缺页异常发生时，csr STVAL寄存器被硬件自动设置为该出错的VA地址；同时可通过解析csr scause寄存器的值，识别如下三种不同的Page Fault类型：
    Exception Code = 12: page fault caused by an instruction fetch
    Exception Code = 13: page fault caused by a read
    Exception Code = 15: page fault caused by a write

缺页有两个常见的原因，其一是 Lazy 策略，也就是直到内存页面被访问才实际进行页表操作。 比如，一个程序被执行时，进程的代码段理论上需要从磁盘加载到内存。但是 os 并不会马上这样做， 而是会保存 .text 段在磁盘的位置信息，在这些代码第一次被执行时才完成从磁盘的加载操作。
 3）这样做有哪些好处？
 答：内存资源是比较紧缺的资源，这样做的好处是可以提高内存资源的利用率，减少内存资源的浪费。

其实，我们的 mmap 也可以采取 Lazy 策略，比如：一个用户进程先后申请了 10G 的内存空间， 然后用了其中 1M 就直接退出了。按照现在的做法，我们显然亏大了，进行了很多没有意义的页表操作。
 4）处理 10G 连续的内存页面，对应的 SV39 页表大致占用多少内存 (估算数量级即可)？
 答：大约需要40KB的内存。

 5）请简单思考如何才能实现 Lazy 策略，缺页时又如何处理？描述合理即可，不需要考虑实现。
 答：可以正常建立页表映射，但将V位设置为0，表示页面还未分配。当缺页异常发生时，分配物理页，并设置V位为1。

缺页的另一个常见原因是 swap 策略，也就是内存页面可能被换到磁盘上了，导致对应页面失效。
 6）此时页面失效如何表现在页表项(PTE)上？
 答：将V位设置为0,通过其他位表示被换出。

3、双页表与单页表
 1）在单页表情况下，如何更换页表？
 答：单页表情况下，用户态与内核态切换不需要更换页表。当任务切换时，才需要更换页表。

 2）单页表情况下，如何控制用户态无法访问内核页面？（tips:看看上一题最后一问）
 答：通过页表标志为的U标志位控制。

 3）单页表有何优势？（回答合理即可）
 答：减少页表切换，提升性能。

 4）双页表实现下，何时需要更换页表？假设你写一个单页表操作系统，你会选择何时更换页表（回答合理即可）？
 答：当用户态/内核态切换时需要更换页表。


三、荣誉准则
1、在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

    无。

2、此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

    无。

3、我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4、我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。